<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sonora UC3M · Programación y podcasts</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <style>
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #be1622;
      color: #fff;
    }

    .page {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 16px 120px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-main {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .brand-sub {
      font-size: 0.9rem;
      opacity: 0.85;
    }

    .btn-ghost {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.8);
      padding: 8px 16px;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      background: transparent;
      color: #fff;
      text-decoration: none;
      transition: 0.2s;
    }

    .btn-ghost:hover {
      background: rgba(255,255,255,0.16);
    }

    h1 {
      margin: 0 0 10px;
      font-size: 2rem;
    }

    .hero-text {
      font-size: 0.95rem;
      opacity: 0.9;
      max-width: 520px;
      margin-bottom: 24px;
    }

    section {
      background: #ffffff;
      color: #222;
      border-radius: 18px;
      padding: 18px 18px 20px;
      margin-bottom: 22px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    }

    .section-title {
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 6px;
    }

    .section-sub {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 14px;
    }

    /* Programas en diferido */

    .programas-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .programa {
      padding: 10px 12px;
      border-radius: 12px;
      background: #f4f4f4;
    }

    .programa-nombre {
      font-weight: 700;
      margin-bottom: 4px;
    }

    .programa-desc {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 6px;
    }

    .programa-link {
      font-size: 0.8rem;
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: #be1622;
      color: #fff;
      text-decoration: none;
      font-weight: 600;
    }

    .programa-link:hover {
      background: #92101a;
    }

    /* Directo */

    .live-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .live-dia {
      background: #fafafa;
      border-radius: 12px;
      padding: 10px 12px;
    }

    .live-dia-nombre {
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.9rem;
      margin-bottom: 6px;
      color: #be1622;
    }

    .live-slot {
      font-size: 0.85rem;
      color: #444;
    }

    .live-slot span {
      font-weight: 600;
    }

    /* Botón flotante (escuchar en directo) */

    .floating-player-btn {
      position: fixed;
      right: 16px;
      bottom: 16px;
      border-radius: 999px;
      background: #ffffff;
      color: #be1622;
      padding: 10px 16px;
      font-size: 0.85rem;
      font-weight: 700;
      text-decoration: none;
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .floating-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #ff5252;
      box-shadow: 0 0 0 4px rgba(255,82,82,0.5);
    }

    footer {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 8px;
      text-align: center;
      color: #ffe6e6;
    }

    @media (max-width: 600px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>

  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-main">Sonora UC3M</div>
        <div class="brand-sub">Programación y escucha en diferido</div>
      </div>
      <a class="btn-ghost" href="https://www.instagram.com/sonorauc3m" target="_blank">@sonorauc3m</a>
    </header>

    <h1>Todo lo que suena en Sonora</h1>
    <p class="hero-text">
      Martes y jueves emitimos en directo. El resto del tiempo, puedes escuchar nuestros programas
      en diferido cuando quieras.
      Los datos se actualizan automáticamente desde una hoja de cálculo de Google.
    </p>

    <!-- Programas en diferido -->
    <section>
      <div class="section-title">Programas en diferido</div>
      <div class="section-sub">Lista de programas (como en tu Linktree), actualizada desde Google Sheets.</div>
      <div id="programas-list" class="programas-list">
        <!-- Rellenado por JavaScript -->
      </div>
    </section>

    <!-- Directo martes y jueves -->
    <section>
      <div class="section-title">Directo · Martes y Jueves</div>
      <div class="section-sub">Solo esos días emitimos desde el estudio. Horarios en hora peninsular (CET).</div>
      <div id="live-list" class="live-list">
        <!-- Rellenado por JavaScript -->
      </div>
    </section>

    <footer>
      La radio de la Universidad Carlos III de Madrid · Sonora UC3M
    </footer>
  </div>

  <!-- Botón flotante hacia el player público -->
  <a class="floating-player-btn" href="https://radio.radiobot.org/public/sonora" target="_blank">
    <span class="floating-dot"></span>
    <span>Escuchar en directo</span>
  </a>

  <script>
    // ⬇️ PON AQUÍ EL ID DE TU HOJA DE GOOGLE (EL LARGO DE LETRAS Y NÚMEROS)
    const SHEET_ID = "SHEET_ID_AQUI"; 

    const ODF_SHEET_NAME = "OnDemand"; // pestaña 1
    const LIVE_SHEET_NAME = "Directo";  // pestaña 2

    // Construye URL tipo gviz para leer cada pestaña en JSON
    function gvizUrl(sheetName) {
      return `https://docs.google.com/spreadsheets/d/${1g9f3Ue9GtdaTbpxp3DCXncrNPhjnHPk0m9QTXdfSAxM/edit?gid=885914669#gid=885914669}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
    }

    async function fetchSheet(sheetName) {
      const res = await fetch(gvizUrl(sheetName));
      const text = await res.text();
      // Recortar el wrapper "google.visualization.Query.setResponse(...);"
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;
      // Convertimos filas en arrays [col0, col1, ...] de strings
      return rows.map(r => (r.c || []).map(c => (c && c.v) ? String(c.v) : ""));
    }

    async function loadData() {
      try {
        const [onDemandRows, liveRows] = await Promise.all([
          fetchSheet(ODF_SHEET_NAME),
          fetchSheet(LIVE_SHEET_NAME)
        ]);

        renderOnDemand(onDemandRows);
        renderLive(liveRows);
      } catch (err) {
        console.error("Error cargando datos:", err);
        document.getElementById("programas-list").innerHTML =
          "<div style='font-size:0.85rem;color:#666;'>No se ha podido cargar la programación ahora mismo.</div>";
      }
    }

    function renderOnDemand(rows) {
      const cont = document.getElementById("programas-list");
      cont.innerHTML = "";

      if (!rows.length) {
        cont.textContent = "No hay programas configurados todavía.";
        return;
      }

      // Primera fila = cabecera, la ignoramos
      rows.slice(1).forEach(cols => {
        const [nombre, descripcion, enlace] = cols;

        if (!nombre) return;

        const div = document.createElement("div");
        div.className = "programa";

        const title = document.createElement("div");
        title.className = "programa-nombre";
        title.textContent = nombre;

        const desc = document.createElement("div");
        desc.className = "programa-desc";
        desc.textContent = descripcion || "";

        div.appendChild(title);
        if (descripcion) div.appendChild(desc);

        if (enlace) {
          const a = document.createElement("a");
          a.className = "programa-link";
          a.href = enlace;
          a.target = "_blank";
          a.textContent = "Escuchar / más info";
          div.appendChild(a);
        }

        cont.appendChild(div);
      });
    }

    function renderLive(rows) {
      const cont = document.getElementById("live-list");
      cont.innerHTML = "";

      if (!rows.length) {
        cont.textContent = "No hay horarios configurados todavía.";
        return;
      }

      // Agrupar por día (Martes / Jueves)
      const byDay = {};
      rows.slice(1).forEach(cols => {
        const [dia, hora, programa] = cols;
        if (!dia || !hora || !programa) return;

        const key = dia.trim().toLowerCase(); // "martes", "jueves"
        if (!byDay[key]) byDay[key] = [];
        byDay[key].push({ hora, programa });
      });

      ["martes", "jueves"].forEach(key => {
        const slots = byDay[key];
        if (!slots || !slots.length) return;

        const diaDiv = document.createElement("div");
        diaDiv.className = "live-dia";

        const nombre = document.createElement("div");
        nombre.className = "live-dia-nombre";
        nombre.textContent = key.toUpperCase();
        diaDiv.appendChild(nombre);

        slots.forEach(s => {
          const p = document.createElement("div");
          p.className = "live-slot";
          p.innerHTML = `<span>${s.hora}</span> · ${s.programa}`;
          diaDiv.appendChild(p);
        });

        cont.appendChild(diaDiv);
      });
    }

    document.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
